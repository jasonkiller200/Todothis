# 🔐 系統安全功能說明

## 已實現的安全機制

### 1. 用戶認證 (Authentication)
- **密碼雜湊加密**: 使用 Werkzeug 的 `generate_password_hash` 和 `check_password_hash` 進行密碼加密存儲
- **會話管理**: 基於 Flask Session 的安全會話管理
- **自動登出**: 檢查用戶狀態，無效用戶自動清除會話

### 2. 帳戶安全
- **登入失敗鎖定**: 連續3次登入失敗後鎖定帳戶30分鐘
- **帳戶狀態管理**: 支援啟用/停用帳戶功能
- **密碼重置**: 管理員可重置用戶密碼並生成臨時密碼
- **密碼變更**: 用戶可自行變更密碼，需驗證舊密碼

### 3. 權限控制 (Authorization)
- **基於角色的權限控制 (RBAC)**: 
  - 廠長 (director): 最高權限，可查看所有數據
  - 協理 (manager): 可管理自己部門的數據
  - 副理 (assistant-manager): 可查看部門統計
  - 課長 (section-chief): 可管理下級員工
  - 組長 (team-leader): 可管理組內員工
  - 作業員 (staff): 只能管理自己的待辦事項

### 4. API 安全
- **登入驗證裝飾器**: `@login_required` 確保 API 需要登入才能存取
- **管理員權限裝飾器**: `@admin_required` 限制管理功能
- **權限檢查**: 每個 API 都會檢查用戶是否有權限存取特定資源
- **輸入驗證**: 驗證 API 請求的必要欄位

### 5. 數據保護
- **權限隔離**: 用戶只能看到有權限的數據
- **部門隔離**: 非廠長用戶只能看到自己部門的統計數據
- **操作記錄**: 記錄最後登入時間和失敗嘗試次數

## 權限矩陣

| 功能 | 廠長 | 協理 | 副理 | 課長 | 組長 | 作業員 |
|------|------|------|------|------|------|--------|
| 查看所有用戶 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 查看部門用戶 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 查看下級用戶 | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| 管理用戶帳戶 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 查看部門統計 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| 匯出數據 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 新增他人待辦 | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| 修改自己待辦 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |

## 測試帳戶

| 角色 | 電子郵件 | 密碼 | 權限說明 |
|------|----------|------|----------|
| 廠長 | director@company.com | password123 | 最高權限，可管理所有用戶和數據 |
| 協理 | manager1@company.com | password123 | 可管理部門用戶和查看統計 |
| 副理 | assistant1@company.com | password123 | 可查看部門統計 |
| 課長 | chief1@company.com | password123 | 可管理下級員工 |
| 組長 | leader1@company.com | password123 | 可管理組內員工 |
| 作業員 | staff1@company.com | password123 | 只能管理自己的待辦事項 |

## 安全建議

### 部署前必須執行的安全措施：
1. **更改預設密碼**: 所有測試帳戶的預設密碼必須更改
2. **設定強密碼政策**: 建議密碼長度至少8位，包含大小寫字母、數字和特殊字元
3. **啟用 HTTPS**: 生產環境必須使用 HTTPS 加密傳輸
4. **設定安全的 SECRET_KEY**: 使用 `secrets.token_hex(32)` 生成的密鑰
5. **定期備份數據庫**: 建立定期備份機制
6. **監控登入活動**: 監控異常登入行為

### 進階安全功能建議：
1. **雙因素認證 (2FA)**: 為管理員帳戶啟用 2FA
2. **IP 白名單**: 限制管理功能只能從特定 IP 存取
3. **操作日誌**: 記錄所有重要操作的詳細日誌
4. **定期密碼更新**: 強制用戶定期更新密碼
5. **會話超時**: 設定會話自動超時機制

## 安全測試

### 建議進行的安全測試：
1. **暴力破解測試**: 驗證帳戶鎖定機制
2. **權限提升測試**: 確認用戶無法存取超出權限的資源
3. **會話劫持測試**: 驗證會話安全性
4. **SQL 注入測試**: 雖然使用 ORM，仍建議測試
5. **XSS 攻擊測試**: 測試輸入過濾和輸出編碼

## 聯絡資訊

如有安全問題或建議，請聯繫系統管理員。

---
*此文檔會隨著系統更新而持續維護*




