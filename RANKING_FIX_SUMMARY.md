# 排行榜並列排名修正說明

## 修正日期
2025-10-08

## 修正內容

### 問題描述
排行榜中當多人成績相同並列第一名時，標章符號不一致：
- 第一個人顯示 🥇
- 第二個人顯示 🥈
- 這樣會造成誤解，因為他們實際上是並列第一名

### 修正方案
修改排行榜邏輯，根據實際數值判斷排名，而不是單純使用索引位置：

1. **完成任務數排行**
   - 追蹤前一名的完成任務數
   - 如果當前人員的完成任務數與前一名相同，則使用相同排名和標章
   - 如果不同，則排名為當前索引+1

2. **完成率排行**
   - 追蹤前一名的完成率
   - 如果當前人員的完成率與前一名相同，則使用相同排名和標章
   - 如果不同，則排名為當前索引+1

### 修改的檔案

#### 1. templates/reports_meeting_tasks.html
- **位置**: 第1026-1047行（完成任務數排行）
- **位置**: 第1049-1074行（完成率排行）
- **修改**: 
  - 新增 `currentRank` 和 `prevValue` 變數追蹤實際排名
  - 根據數值變化動態更新排名
  - 使用 `currentRank` 而非 `index` 來決定標章符號

#### 2. templates/reports_todo.html
- **位置**: 第883-910行（個人排行榜）
- **修改**:
  - 新增 `currentRank` 和 `prevValue` 變數追蹤實際排名
  - 根據完成任務數變化動態更新排名
  - 使用 `currentRank` 而非 `index` 來決定標章符號

### 實現邏輯示例

```javascript
// 計算實際排名（考慮並列）
let currentRank = 1;
let prevValue = null;
data.rankings.forEach((item, index) => {
    // 如果數值與前一名不同，更新排名
    if (prevValue !== null && item.completed_tasks !== prevValue) {
        currentRank = index + 1;
    }
    prevValue = item.completed_tasks;
    
    // 使用 currentRank 而非 index 來決定標章
    const medal = currentRank === 1 ? '🥇' : currentRank === 2 ? '🥈' : currentRank === 3 ? '🥉' : `#${currentRank}`;
    // ... 渲染邏輯
});
```

### 範例說明

**修改前**:
- 張三: 10個任務 → 🥇
- 李四: 10個任務 → 🥈 (錯誤！應該也是第一名)
- 王五: 8個任務 → 🥉

**修改後**:
- 張三: 10個任務 → 🥇
- 李四: 10個任務 → 🥇 (正確！並列第一)
- 王五: 8個任務 → 🥉 (正確！實際排名第三)

### 測試建議

1. 訪問 http://192.168.6.119:5001/reports/meeting-tasks
2. 切換到「個人排行榜」頁籤
3. 檢查完成任務數排行和完成率排行
4. 確認並列排名使用相同標章符號

5. 訪問 http://192.168.6.119:5001/reports/todo
6. 切換到「個人排行榜」頁籤
7. 確認並列排名使用相同標章符號

### 影響範圍
- ✅ 會議任務報表的個人排行榜
- ✅ 待辦事項報表的個人排行榜
- ✅ 不影響其他功能
- ✅ 僅修改前端顯示邏輯，不影響後端數據

## 結論
此修正確保排行榜能夠正確顯示並列排名，多人成績相同時會使用相同的標章符號，讓排名更加公平且易於理解。
