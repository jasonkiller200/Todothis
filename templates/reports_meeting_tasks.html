<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Task å ±å‘Š</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <style>
        :root {
            --color-primary: #667eea;
            --color-secondary: #764ba2;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-info: #3b82f6;
            --color-background: #f0f2f5;
            --color-white: #fff;
            --color-text: #333;
            --color-text-light: #666;
            --color-border: #e5e7eb;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--color-text);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--color-white);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            padding: 30px;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* é ‚éƒ¨å°èˆª */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--color-background);
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
        }
        
        .nav-tab {
            padding: 10px 20px;
            background: var(--color-background);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--color-text);
        }
        
        .nav-tab:hover {
            background: var(--color-primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
        }
        
        .btn-home {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        /* é é¢æ¨™é¡Œ */
        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .page-header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .page-header p {
            color: var(--color-text-light);
            font-size: 1.1em;
        }
        
        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--color-background) 0%, #fff 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border-left: 4px solid var(--color-primary);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-card.success { border-left-color: var(--color-success); }
        .stat-card.warning { border-left-color: var(--color-warning); }
        .stat-card.danger { border-left-color: var(--color-danger); }
        .stat-card.info { border-left-color: var(--color-info); }
        
        .stat-card .icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card.success .value { color: var(--color-success); }
        .stat-card.warning .value { color: var(--color-warning); }
        .stat-card.danger .value { color: var(--color-danger); }
        .stat-card.info .value { color: var(--color-info); }
        
        .stat-card .label {
            color: var(--color-text-light);
            font-size: 0.95em;
        }
        
        /* åŠŸèƒ½åˆ†é  */
        .function-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: var(--color-background);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
            color: var(--color-text);
        }
        
        .tab:hover {
            background: var(--color-primary);
            color: white;
        }
        
        .tab.active {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        /* å…§å®¹å€åŸŸ */
        .content-area {
            background: white;
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
        }
        
        .tab-pane {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* è¼‰å…¥å‹•ç•« */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--color-text-light);
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* ç©ºæ•¸æ“š */
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--color-text-light);
        }
        
        .no-data .icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        /* ç¯©é¸å™¨ */
        .filters {
            background: var(--color-background);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-size: 0.9em;
            color: var(--color-text-light);
            font-weight: 500;
            min-height: 1.2em;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            background: white;
            min-width: 150px;
            height: 38px;
        }
        
        .btn-filter {
            padding: 8px 20px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            height: 38px;
        }
        
        .btn-filter:hover {
            background: var(--color-secondary);
            transform: translateY(-2px);
        }
        
        /* è¡¨æ ¼æ¨£å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table thead {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }
        
        .data-table tbody tr:hover {
            background: var(--color-background);
        }
        
        .data-table .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status-completed { background: #d4edda; color: #155724; }
        .status-in-progress { background: #fff3cd; color: #856404; }
        .status-unassigned { background: #e2e3e5; color: #383d41; }
        .status-overdue { background: #f8d7da; color: #721c24; }
        
        /* æ’è¡Œæ¦œæ¨£å¼ */
        .ranking-list {
            list-style: none;
        }
        
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--color-background);
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .ranking-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }
        
        .ranking-medal {
            font-size: 2em;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
        }
        
        .ranking-info {
            flex: 1;
        }
        
        .ranking-name {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .ranking-details {
            font-size: 0.9em;
            color: var(--color-text-light);
        }
        
        .ranking-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--color-primary);
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é ‚éƒ¨å°èˆª -->
        <div class="top-nav">
            <div class="nav-tabs">
                <a href="{{ url_for('reports_todo') }}" class="nav-tab">ğŸ“ Todo ä»»å‹™</a>
                <a href="{{ url_for('reports_meeting_tasks') }}" class="nav-tab active">ğŸ“‹ Meeting Task</a>
            </div>
            <a href="{{ url_for('reports') }}" class="btn-home">â† è¿”å›å ±å‘Šä¸­å¿ƒ</a>
        </div>

        <!-- é é¢æ¨™é¡Œ -->
        <div class="page-header">
            <h1>ğŸ“‹ Meeting Task å ±å‘Š</h1>
            <p>æœƒè­°ä»»å‹™çµ±è¨ˆåˆ†æèˆ‡ç®¡ç†</p>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="stats-cards" id="statsCards">
            <div class="stat-card info">
                <div class="icon">ğŸ“Š</div>
                <div class="value" id="statTotal">-</div>
                <div class="label">ç¸½ä»»å‹™æ•¸</div>
            </div>
            <div class="stat-card success">
                <div class="icon">âœ…</div>
                <div class="value" id="statCompleted">-</div>
                <div class="label">å·²å®Œæˆè¿½è¹¤</div>
            </div>
            <div class="stat-card success" style="border-left: 4px solid #10b981;">
                <div class="icon">âœ…</div>
                <div class="value" id="statAgreed">-</div>
                <div class="label">å·²åŒæ„æ±ºè­°</div>
            </div>
            <div class="stat-card warning">
                <div class="icon">â³</div>
                <div class="value" id="statInProgress">-</div>
                <div class="label">é€²è¡Œä¸­è¿½è¹¤</div>
            </div>
            <div class="stat-card danger">
                <div class="icon">ğŸ”´</div>
                <div class="value" id="statOverdue">-</div>
                <div class="label">é€¾æœŸä»»å‹™</div>
            </div>
        </div>

        <!-- ç¯©é¸å™¨ -->
        <div class="filters" id="filters" style="display:none;">
            <div class="filter-group">
                <label>æ™‚é–“ç¯„åœ</label>
                <select id="filterPeriod">
                    <option value="week">æœ¬é€±</option>
                    <option value="month" selected>æœ¬æœˆ</option>
                    <option value="last_month">ä¸Šå€‹æœˆ</option>
                    <option value="quarter">æœ¬å­£</option>
                    <option value="year">æœ¬å¹´</option>
                    <option value="all">å…¨éƒ¨</option>
                </select>
            </div>
            <div class="filter-group">
                <label>ä»»å‹™é¡å‹</label>
                <select id="filterTaskType">
                    <option value="">å…¨éƒ¨</option>
                    <option value="tracking">è¿½è¹¤é …ç›®</option>
                    <option value="resolution">æ±ºè­°é …ç›®</option>
                </select>
            </div>
            <div class="filter-group">
                <label>è² è²¬äºº</label>
                <select id="filterUser">
                    <option value="">å…¨éƒ¨</option>
                </select>
            </div>
            <button class="btn-filter" onclick="applyFilters()">ğŸ” å¥—ç”¨ç¯©é¸</button>
        </div>

        <!-- åŠŸèƒ½åˆ†é  -->
        <div class="function-tabs">
            <button class="tab active" data-tab="overview" onclick="switchTab('overview')">ğŸ“Š æ¦‚è¦½çµ±è¨ˆ</button>
            <button class="tab" data-tab="list" onclick="switchTab('list')">ğŸ“‹ å·²å®Œæˆä»»å‹™</button>
            <button class="tab" data-tab="in-progress" onclick="switchTab('in-progress')">â³ é€²è¡Œä¸­è¿½è¹¤</button>
            <button class="tab" data-tab="overdue" onclick="switchTab('overdue')">ğŸ”´ é€¾æœŸä»»å‹™</button>
            <button class="tab" data-tab="pending-resolutions" onclick="switchTab('pending-resolutions')">âœ… å¾…åŒæ„æ±ºè­°</button>
            <button class="tab" data-tab="unassigned-tracking" onclick="switchTab('unassigned-tracking')">â¸ï¸ å¾…æŒ‡æ´¾è¿½è¹¤</button>
            <button class="tab" data-tab="ranking" onclick="switchTab('ranking')">ğŸ† å€‹äººæ’è¡Œ</button>
        </div>

        <!-- å…§å®¹å€åŸŸ -->
        <div class="content-area">
            <!-- æ¦‚è¦½çµ±è¨ˆåˆ†é  -->
            <div id="tab-overview" class="tab-pane active">
                <h2>ğŸ“Š ä»»å‹™æ¦‚è¦½çµ±è¨ˆ</h2>
                <div class="loading">è¼‰å…¥ä¸­...</div>
            </div>

            <!-- å·²å®Œæˆä»»å‹™åˆ—è¡¨åˆ†é  -->
            <div id="tab-list" class="tab-pane">
                <h2>ğŸ“‹ å·²å®Œæˆä»»å‹™åˆ—è¡¨</h2>
                <div class="loading">è¼‰å…¥ä¸­...</div>
            </div>
            
            <!-- é€²è¡Œä¸­ä»»å‹™åˆ†é  -->
            <div id="tab-in-progress" class="tab-pane">
                <h2>â³ é€²è¡Œä¸­ä»»å‹™</h2>
                <div class="loading">è¼‰å…¥ä¸­...</div>
            </div>

            <!-- é€¾æœŸä»»å‹™åˆ†é  -->
            <div id="tab-overdue" class="tab-pane">
                <h2>ğŸ”´ é€¾æœŸä»»å‹™</h2>
                <div class="loading">è¼‰å…¥ä¸­...</div>
            </div>
            
            <!-- å¾…åŒæ„æ±ºè­°åˆ†é  -->
            <div id="tab-pending-resolutions" class="tab-pane">
                <h2>âœ… å¾…åŒæ„æ±ºè­°é …ç›®</h2>
                <div class="loading">è¼‰å…¥ä¸­...</div>
            </div>
            
            <!-- å¾…æŒ‡æ´¾è¿½è¹¤åˆ†é  -->
            <div id="tab-unassigned-tracking" class="tab-pane">
                <h2>â¸ï¸ å¾…æŒ‡æ´¾è¿½è¹¤é …ç›®</h2>
                <div class="loading">è¼‰å…¥ä¸­...</div>
            </div>
            
            <!-- å€‹äººæ’è¡Œåˆ†é  -->
            <div id="tab-ranking" class="tab-pane">
                <h2>ğŸ† å€‹äººæ’è¡Œæ¦œ</h2>
                <div class="loading">è¼‰å…¥ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentTab = 'overview';
        let allUsers = [];
        let currentFilters = {
            period: 'month',
            taskType: '',
            status: '',
            user: ''
        };

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            await loadUsers();
            await loadUserList();  // è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨
            loadOverviewData();
        });

        // è¼‰å…¥ä½¿ç”¨è€…åˆ—è¡¨
        async function loadUsers() {
            try {
                const response = await fetch('/api/all_users');
                allUsers = await response.json();
                
                const filterUser = document.getElementById('filterUser');
                filterUser.innerHTML = '<option value="">å…¨éƒ¨</option>';
                allUsers.forEach(user => {
                    if (user.level !== 'admin') {
                        const option = document.createElement('option');
                        option.value = user.user_id;
                        option.textContent = `${user.name} (${user.role})`;
                        filterUser.appendChild(option);
                    }
                });
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // åˆ‡æ›åˆ†é 
        function switchTab(tabName) {
            currentTab = tabName;
            
            // æ›´æ–°åˆ†é æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // æ›´æ–°å…§å®¹å€åŸŸ
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // é¡¯ç¤º/éš±è—ç¯©é¸å™¨
            const filtersDiv = document.getElementById('filters');
            if (tabName === 'overview') {
                filtersDiv.style.display = 'none';
                loadOverviewData();
            } else if (tabName === 'list') {
                filtersDiv.style.display = 'flex';
                loadListData();
            } else if (tabName === 'in-progress') {
                filtersDiv.style.display = 'none';
                loadInProgressData();
            } else if (tabName === 'overdue') {
                filtersDiv.style.display = 'none';
                loadOverdueData();
            } else if (tabName === 'pending-resolutions') {
                filtersDiv.style.display = 'none';
                loadPendingResolutionsData();
            } else if (tabName === 'unassigned-tracking') {
                filtersDiv.style.display = 'none';
                loadUnassignedTrackingData();
            } else if (tabName === 'ranking') {
                filtersDiv.style.display = 'none';
                loadRankingData();
            }
        }

        // å¥—ç”¨ç¯©é¸
        function applyFilters() {
            currentFilters.period = document.getElementById('filterPeriod').value;
            currentFilters.taskType = document.getElementById('filterTaskType').value;
            currentFilters.user = document.getElementById('filterUser').value;
            
            if (currentTab === 'list') {
                loadListData();
            }
        }
        
        // è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨ï¼ˆå¾å¯¦éš›æ•¸æ“šä¸­ç²å–ï¼‰
        async function loadUserList() {
            try {
                // ç²å–æ‰€æœ‰ä»»å‹™ä¾†æå–ç”¨æˆ¶åˆ—è¡¨
                const response = await fetch('/api/reports/meeting-tasks/list?period=all');
                const data = await response.json();
                
                if (data.tasks) {
                    // æå–å”¯ä¸€çš„è² è²¬äºº
                    const users = new Map();
                    data.tasks.forEach(task => {
                        if (task.assigned_to_name) {
                            users.set(task.assigned_to_name, true);
                        }
                    });
                    
                    // å¡«å……ä¸‹æ‹‰é¸å–®
                    const userSelect = document.getElementById('filterUser');
                    userSelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
                    Array.from(users.keys()).sort().forEach(userName => {
                        userSelect.innerHTML += `<option value="${userName}">${userName}</option>`;
                    });
                }
            } catch (error) {
                console.error('Error loading user list:', error);
            }
        }

        // è¼‰å…¥æ¦‚è¦½æ•¸æ“š
        async function loadOverviewData() {
            try {
                const response = await fetch('/api/reports/meeting-tasks/overview');
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                // æ›´æ–°çµ±è¨ˆå¡ç‰‡
                document.getElementById('statTotal').textContent = data.current.total || 0;
                document.getElementById('statCompleted').textContent = data.current.completed || 0;
                document.getElementById('statAgreed').textContent = data.current.agreed || 0;  // æ–°å¢
                document.getElementById('statInProgress').textContent = data.current.in_progress || 0;
                document.getElementById('statOverdue').textContent = data.current.overdue || 0;
                
                // é¡¯ç¤ºè©³ç´°çµ±è¨ˆ
                const overviewTab = document.getElementById('tab-overview');
                overviewTab.innerHTML = `
                    <h2>ğŸ“Š ä»»å‹™æ¦‚è¦½çµ±è¨ˆ</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="background: var(--color-background); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--color-primary); margin-bottom: 15px;">æœ¬é€±çµ±è¨ˆ</h3>
                            <p>ç¸½ä»»å‹™: <strong>${data.week.total}</strong></p>
                            <p>å·²å®Œæˆ: <strong style="color: var(--color-success);">${data.week.completed}</strong></p>
                            <p>é€²è¡Œä¸­è¿½è¹¤: <strong style="color: var(--color-warning);">${data.week.in_progress}</strong></p>
                            <p>é€¾æœŸ: <strong style="color: var(--color-danger);">${data.week.overdue}</strong></p>
                            <p>å®Œæˆç‡: <strong>${data.week.total > 0 ? Math.round(data.week.completed / data.week.total * 100) : 0}%</strong></p>
                        </div>
                        <div style="background: var(--color-background); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--color-primary); margin-bottom: 15px;">æœ¬æœˆçµ±è¨ˆ</h3>
                            <p>ç¸½ä»»å‹™: <strong>${data.month.total}</strong></p>
                            <p>å·²å®Œæˆ: <strong style="color: var(--color-success);">${data.month.completed}</strong></p>
                            <p>é€²è¡Œä¸­è¿½è¹¤: <strong style="color: var(--color-warning);">${data.month.in_progress}</strong></p>
                            <p>é€¾æœŸ: <strong style="color: var(--color-danger);">${data.month.overdue}</strong></p>
                            <p>å®Œæˆç‡: <strong>${data.month.total > 0 ? Math.round(data.month.completed / data.month.total * 100) : 0}%</strong></p>
                        </div>
                        <div style="background: var(--color-background); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--color-primary); margin-bottom: 15px;">æœ¬å¹´çµ±è¨ˆ</h3>
                            <p>ç¸½ä»»å‹™: <strong>${data.year.total}</strong></p>
                            <p>å·²å®Œæˆ: <strong style="color: var(--color-success);">${data.year.completed}</strong></p>
                            <p>é€²è¡Œä¸­è¿½è¹¤: <strong style="color: var(--color-warning);">${data.year.in_progress}</strong></p>
                            <p>é€¾æœŸ: <strong style="color: var(--color-danger);">${data.year.overdue}</strong></p>
                            <p>å®Œæˆç‡: <strong>${data.year.total > 0 ? Math.round(data.year.completed / data.year.total * 100) : 0}%</strong></p>
                        </div>
                        <div style="background: var(--color-background); padding: 20px; border-radius: 10px;">
                            <h3 style="color: var(--color-primary); margin-bottom: 15px;">å…¨éƒ¨çµ±è¨ˆ</h3>
                            <p>ç¸½ä»»å‹™: <strong>${data.all.total}</strong></p>
                            <p>å·²å®Œæˆ: <strong style="color: var(--color-success);">${data.all.completed}</strong></p>
                            <p>é€²è¡Œä¸­è¿½è¹¤: <strong style="color: var(--color-warning);">${data.all.in_progress}</strong></p>
                            <p>é€¾æœŸ: <strong style="color: var(--color-danger);">${data.all.overdue}</strong></p>
                            <p>å®Œæˆç‡: <strong>${data.all.total > 0 ? Math.round(data.all.completed / data.all.total * 100) : 0}%</strong></p>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading overview:', error);
                showError('è¼‰å…¥æ¦‚è¦½æ•¸æ“šå¤±æ•—');
            }
        }

        // è¼‰å…¥åˆ—è¡¨æ•¸æ“š
        async function loadListData(page = 1) {
            try {
                const params = new URLSearchParams({
                    period: currentFilters.period,
                    page: page,
                    per_page: 50,
                    ...(currentFilters.taskType && { task_type: currentFilters.taskType }),
                    ...(currentFilters.user && { user_name: currentFilters.user })
                });
                
                const response = await fetch(`/api/reports/meeting-tasks/list?${params}`);
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                const listTab = document.getElementById('tab-list');
                
                if (data.tasks.length === 0) {
                    listTab.innerHTML = '<h2>ğŸ“‹ å·²å®Œæˆä»»å‹™åˆ—è¡¨</h2><div class="no-data"><div class="icon">ğŸ‰</div><p>æ²’æœ‰å·²å®Œæˆçš„ä»»å‹™</p></div>';
                    return;
                }
                
                let html = '<h2>ğŸ“‹ å·²å®Œæˆä»»å‹™åˆ—è¡¨</h2>';
                html += `<p style="color: var(--color-success); margin-bottom: 20px;">âœ… å…±æœ‰ ${data.total} å€‹å·²å®Œæˆçš„ä»»å‹™</p>`;
                html += '<table class="data-table">';
                html += '<thead><tr>';
                html += '<th>ç·¨è™Ÿ</th>';
                html += '<th>æœƒè­°ä¸»é¡Œ</th>';
                html += '<th>ä»»å‹™é¡å‹</th>';
                html += '<th>ä»»å‹™å…§å®¹</th>';
                html += '<th>è² è²¬äºº</th>';
                html += '<th>ç®¡åˆ¶è€…</th>';
                html += '<th>é è¨ˆå®Œæˆ</th>';
                html += '<th>ç‹€æ…‹</th>';
                html += '</tr></thead>';
                html += '<tbody>';
                
                data.tasks.forEach((task, index) => {
                    let statusClass, statusText;
                    
                    // æ±ºè­°é …ç›®å’Œè¿½è¹¤é …ç›®åˆ†åˆ¥è™•ç†ç‹€æ…‹é¡¯ç¤º
                    if (task.task_type === 'resolution') {
                        // æ±ºè­°é …ç›®ï¼šæ ¹æ“šæ˜¯å¦å·²åŒæ„ä¾†é¡¯ç¤ºç‹€æ…‹
                        if (task.status === 'agreed_finalized') {
                            statusClass = 'status-completed';
                            statusText = 'âœ… å·²åŒæ„';
                        } else if (task.status === 'completed') {
                            statusClass = 'status-completed';
                            statusText = 'âœ… å·²å®Œæˆ';
                        } else {
                            statusClass = 'status-in-progress';
                            statusText = 'â³ å¾…åŒæ„';
                        }
                    } else {
                        // è¿½è¹¤é …ç›®ï¼šä½¿ç”¨åŸæœ‰çš„é€¾æœŸå’Œç‹€æ…‹é‚è¼¯
                        if (task.is_overdue) {
                            statusClass = 'status-overdue';
                            statusText = 'âš ï¸ é€¾æœŸ';
                        } else if (task.status === 'completed') {
                            statusClass = 'status-completed';
                            statusText = 'âœ… å·²å®Œæˆ';
                        } else if (task.status === 'in_progress' || 
                                   task.status === 'in_progress_todo' || 
                                   task.status === 'resolved_executing' ||
                                   task.status === 'uncompleted_todo' ||
                                   task.status === 'assigned') {
                            statusClass = 'status-in-progress';
                            statusText = 'â³ é€²è¡Œä¸­';
                        } else if (task.status === 'unassigned') {
                            statusClass = 'status-unassigned';
                            statusText = 'â¸ï¸ æœªæŒ‡æ´¾';
                        } else {
                            statusClass = 'status-unassigned';
                            statusText = 'â¸ï¸ æœªæŒ‡æ´¾';
                        }
                    }
                    
                    html += '<tr>';
                    html += `<td>${index + 1}</td>`;
                    html += `<td>${escapeHtml(task.meeting_subject || '-')}</td>`;
                    html += `<td>${task.task_type === 'tracking' ? 'è¿½è¹¤é …ç›®' : 'æ±ºè­°é …ç›®'}</td>`;
                    html += `<td>${escapeHtml(task.task_description)}</td>`;
                    html += `<td>${escapeHtml(task.assigned_to_name || '-')}</td>`;
                    html += `<td>${escapeHtml(task.controller_name || '-')}</td>`;
                    html += `<td>${task.expected_completion_date || '-'}</td>`;
                    html += `<td><span class="status-badge ${statusClass}">${statusText}</span></td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                
                // æ·»åŠ åˆ†é æ§åˆ¶
                if (data.total_pages > 1) {
                    html += '<div style="margin-top: 20px; text-align: center;">';
                    html += `<span style="margin-right: 10px;">ç¬¬ ${data.page} é ï¼Œå…± ${data.total_pages} é ï¼ˆå…± ${data.total} å€‹ä»»å‹™ï¼‰</span>`;
                    
                    if (data.page > 1) {
                        html += `<button onclick="loadListData(${data.page - 1})" style="margin: 0 5px;">ä¸Šä¸€é </button>`;
                    }
                    
                    // é¡¯ç¤ºé ç¢¼ï¼ˆæœ€å¤šé¡¯ç¤º 5 é ï¼‰
                    let startPage = Math.max(1, data.page - 2);
                    let endPage = Math.min(data.total_pages, data.page + 2);
                    
                    for (let i = startPage; i <= endPage; i++) {
                        if (i === data.page) {
                            html += `<button disabled style="margin: 0 5px; font-weight: bold;">${i}</button>`;
                        } else {
                            html += `<button onclick="loadListData(${i})" style="margin: 0 5px;">${i}</button>`;
                        }
                    }
                    
                    if (data.page < data.total_pages) {
                        html += `<button onclick="loadListData(${data.page + 1})" style="margin: 0 5px;">ä¸‹ä¸€é </button>`;
                    }
                    
                    html += '</div>';
                }
                
                listTab.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading list:', error);
                showError('è¼‰å…¥ä»»å‹™åˆ—è¡¨å¤±æ•—');
            }
        }

        // è¼‰å…¥é€²è¡Œä¸­ä»»å‹™æ•¸æ“š
        async function loadInProgressData() {
            try {
                const response = await fetch('/api/reports/meeting-tasks/in-progress');
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                const inProgressTab = document.getElementById('tab-in-progress');
                
                if (data.tasks.length === 0) {
                    inProgressTab.innerHTML = '<h2>â³ é€²è¡Œä¸­è¿½è¹¤é …ç›®</h2><div class="no-data"><div class="icon">ğŸ‰</div><p>å¤ªæ£’äº†ï¼æ²’æœ‰é€²è¡Œä¸­çš„è¿½è¹¤é …ç›®</p></div>';
                    return;
                }
                
                let html = '<h2>â³ é€²è¡Œä¸­è¿½è¹¤é …ç›®</h2>';
                html += `<p style="color: var(--color-warning); margin-bottom: 20px;">â³ å…±æœ‰ ${data.total} å€‹è¿½è¹¤é …ç›®æ­£åœ¨é€²è¡Œä¸­ï¼ˆä¸å«é€¾æœŸï¼‰</p>`;
                html += '<table class="data-table">';
                html += '<thead><tr>';
                html += '<th>ç·¨è™Ÿ</th>';
                html += '<th>æœƒè­°ä¸»é¡Œ</th>';
                html += '<th>æœƒè­°æ—¥æœŸ</th>';
                html += '<th>ä»»å‹™é¡å‹</th>';
                html += '<th>ä»»å‹™å…§å®¹</th>';
                html += '<th>è² è²¬äºº</th>';
                html += '<th>ç®¡åˆ¶è€…</th>';
                html += '<th>é è¨ˆå®Œæˆ</th>';
                html += '<th>ç‹€æ…‹</th>';
                html += '</tr></thead>';
                html += '<tbody>';
                
                data.tasks.forEach((task, index) => {
                    // æ‰€æœ‰ä»»å‹™éƒ½æ˜¯è¿½è¹¤é …ç›®ï¼Œçµ±ä¸€é¡¯ç¤ºé€²è¡Œä¸­
                    let statusText = 'â³ é€²è¡Œä¸­';
                    let statusClass = 'status-in-progress';
                    
                    html += '<tr>';
                    html += `<td>${index + 1}</td>`;
                    html += `<td>${escapeHtml(task.meeting_subject || '-')}</td>`;
                    html += `<td>${task.meeting_date || '-'}</td>`;
                    html += `<td>è¿½è¹¤é …ç›®</td>`;
                    html += `<td>${escapeHtml(task.task_description)}</td>`;
                    html += `<td>${escapeHtml(task.assigned_to_name || '-')}</td>`;
                    html += `<td>${escapeHtml(task.controller_name || '-')}</td>`;
                    html += `<td>${task.expected_completion_date || '-'}</td>`;
                    html += `<td><span class="status-badge ${statusClass}">${statusText}</span></td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                inProgressTab.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading in-progress tasks:', error);
                showError('è¼‰å…¥é€²è¡Œä¸­ä»»å‹™å¤±æ•—');
            }
        }

        // è¼‰å…¥é€¾æœŸæ•¸æ“š
        async function loadOverdueData() {
            try {
                const response = await fetch('/api/reports/meeting-tasks/overdue');
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                const overdueTab = document.getElementById('tab-overdue');
                
                if (data.tasks.length === 0) {
                    overdueTab.innerHTML = '<h2>ğŸ”´ é€¾æœŸä»»å‹™</h2><div class="no-data"><div class="icon">ğŸ‰</div><p>å¤ªæ£’äº†ï¼ç›®å‰æ²’æœ‰é€¾æœŸä»»å‹™</p></div>';
                    return;
                }
                
                let html = '<h2>ğŸ”´ é€¾æœŸä»»å‹™</h2>';
                html += `<p style="color: var(--color-danger); margin-bottom: 20px;">âš ï¸ å…±æœ‰ ${data.total} å€‹é€¾æœŸçš„è¿½è¹¤é …ç›®éœ€è¦è™•ç†</p>`;
                html += '<table class="data-table">';
                html += '<thead><tr>';
                html += '<th>ç·¨è™Ÿ</th>';
                html += '<th>æœƒè­°ä¸»é¡Œ</th>';
                html += '<th>æœƒè­°æ—¥æœŸ</th>';
                html += '<th>ä»»å‹™å…§å®¹</th>';
                html += '<th>è² è²¬äºº</th>';
                html += '<th>ç®¡åˆ¶è€…</th>';
                html += '<th>é è¨ˆå®Œæˆ</th>';
                html += '<th>é€¾æœŸå¤©æ•¸</th>';
                html += '<th>è™•ç†ç‹€æ…‹</th>';
                html += '</tr></thead>';
                html += '<tbody>';
                
                data.tasks.forEach((task, index) => {
                    // åªé¡¯ç¤ºè¿½è¹¤é …ç›®ï¼ˆæ±ºè­°é …ç›®å·²åœ¨å¾Œç«¯éæ¿¾ï¼‰
                    const overdueClass = task.overdue_days >= 7 ? 'style="background: #ffe6e6;"' : '';
                    const overdueDaysText = `${task.overdue_days} å¤©`;
                    
                    // æ ¹æ“šå¯¦éš›ç‹€æ…‹é¡¯ç¤ºè™•ç†ç‹€æ…‹
                    let statusText = '';
                    let statusClass = '';
                    
                    if (task.status === 'completed') {
                        statusText = 'âœ… å·²å®Œæˆ';
                        statusClass = 'status-completed';
                    } else if (task.status === 'in_progress_todo' || 
                               task.status === 'resolved_executing' || 
                               task.status === 'in_progress' ||
                               task.status === 'uncompleted_todo' ||
                               task.status === 'assigned') {
                        statusText = 'â³ é€²è¡Œä¸­ï¼ˆé€¾æœŸï¼‰';
                        statusClass = 'status-overdue';
                    } else if (task.status === 'unassigned') {
                        statusText = 'â¸ï¸ æœªæŒ‡æ´¾ï¼ˆé€¾æœŸï¼‰';
                        statusClass = 'status-overdue';
                    } else {
                        // å…¶ä»–æœªçŸ¥ç‹€æ…‹
                        statusText = `âš ï¸ é€¾æœŸ`;
                        statusClass = 'status-overdue';
                    }
                    
                    html += `<tr ${overdueClass}>`;
                    html += `<td>${index + 1}</td>`;
                    html += `<td>${escapeHtml(task.meeting_subject || '-')}</td>`;
                    html += `<td>${task.meeting_date || '-'}</td>`;
                    html += `<td>${escapeHtml(task.task_description)}</td>`;
                    html += `<td>${escapeHtml(task.assigned_to_name || '-')}</td>`;
                    html += `<td>${escapeHtml(task.controller_name || '-')}</td>`;
                    html += `<td style="color: var(--color-danger); font-weight: bold;">${task.expected_completion_date || '-'}</td>`;
                    html += `<td style="color: var(--color-danger); font-weight: bold;">${overdueDaysText}</td>`;
                    html += `<td><span class="status-badge ${statusClass}">${statusText}</span></td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                overdueTab.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading overdue:', error);
                showError('è¼‰å…¥é€¾æœŸä»»å‹™å¤±æ•—');
            }
        }

        // è¼‰å…¥æ’è¡Œæ•¸æ“š
        async function loadRankingData() {
            try {
                const response = await fetch('/api/reports/meeting-tasks/ranking');
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                const rankingTab = document.getElementById('tab-ranking');
                
                if (data.rankings.length === 0) {
                    rankingTab.innerHTML = '<h2>ğŸ† å€‹äººæ’è¡Œæ¦œ</h2><div class="no-data"><div class="icon">ğŸ“Š</div><p>æš«ç„¡æ’è¡Œæ•¸æ“š</p></div>';
                    return;
                }
                
                let html = '<h2>ğŸ† å€‹äººæ’è¡Œæ¦œ</h2>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-top: 20px;">';
                
                // å®Œæˆä»»å‹™æ•¸æ’è¡Œ
                html += '<div>';
                html += '<h3 style="color: var(--color-primary); margin-bottom: 15px;">ğŸ“Š å®Œæˆä»»å‹™æ•¸æ’è¡Œ</h3>';
                html += '<ul class="ranking-list">';
                
                // è¨ˆç®—å¯¦éš›æ’åï¼ˆè€ƒæ…®ä¸¦åˆ—ï¼‰
                let currentRank = 1;
                let prevValue = null;
                data.rankings.slice(0, 10).forEach((item, index) => {
                    // å¦‚æœæ•¸å€¼èˆ‡å‰ä¸€åä¸åŒï¼Œæ›´æ–°æ’å
                    if (prevValue !== null && item.completed_tasks !== prevValue) {
                        currentRank = index + 1;
                    }
                    prevValue = item.completed_tasks;
                    
                    const medal = currentRank === 1 ? 'ğŸ¥‡' : currentRank === 2 ? 'ğŸ¥ˆ' : currentRank === 3 ? 'ğŸ¥‰' : `#${currentRank}`;
                    html += `
                        <li class="ranking-item">
                            <div class="ranking-medal">${medal}</div>
                            <div class="ranking-info">
                                <div class="ranking-name">${escapeHtml(item.user_name)}</div>
                                <div class="ranking-details">
                                    ç¸½ä»»å‹™: ${item.total_tasks} | 
                                    å·²å®Œæˆ: ${item.completed_tasks} | 
                                    å®Œæˆç‡: ${item.completion_rate}%
                                </div>
                            </div>
                            <div class="ranking-value">${item.completed_tasks}</div>
                        </li>
                    `;
                });
                html += '</ul></div>';
                
                // å®Œæˆç‡æ’è¡Œ
                html += '<div>';
                html += '<h3 style="color: var(--color-success); margin-bottom: 15px;">ğŸ“ˆ å®Œæˆç‡æ’è¡Œ</h3>';
                html += '<ul class="ranking-list">';
                const sortedByRate = [...data.rankings]
                    .filter(item => item.total_tasks >= 3) // è‡³å°‘3å€‹ä»»å‹™æ‰åˆ—å…¥æ’è¡Œ
                    .sort((a, b) => b.completion_rate - a.completion_rate)
                    .slice(0, 10);
                
                // è¨ˆç®—å¯¦éš›æ’åï¼ˆè€ƒæ…®ä¸¦åˆ—ï¼‰
                let currentRank2 = 1;
                let prevValue2 = null;
                sortedByRate.forEach((item, index) => {
                    // å¦‚æœæ•¸å€¼èˆ‡å‰ä¸€åä¸åŒï¼Œæ›´æ–°æ’å
                    if (prevValue2 !== null && item.completion_rate !== prevValue2) {
                        currentRank2 = index + 1;
                    }
                    prevValue2 = item.completion_rate;
                    
                    const medal = currentRank2 === 1 ? 'ğŸ¥‡' : currentRank2 === 2 ? 'ğŸ¥ˆ' : currentRank2 === 3 ? 'ğŸ¥‰' : `#${currentRank2}`;
                    html += `
                        <li class="ranking-item">
                            <div class="ranking-medal">${medal}</div>
                            <div class="ranking-info">
                                <div class="ranking-name">${escapeHtml(item.user_name)}</div>
                                <div class="ranking-details">
                                    ç¸½ä»»å‹™: ${item.total_tasks} | 
                                    å·²å®Œæˆ: ${item.completed_tasks}
                                </div>
                            </div>
                            <div class="ranking-value">${item.completion_rate}%</div>
                        </li>
                    `;
                });
                html += '</ul></div>';
                
                html += '</div>';
                rankingTab.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading ranking:', error);
                showError('è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—');
            }
        }

        // è¼‰å…¥å¾…åŒæ„æ±ºè­°é …ç›®
        async function loadPendingResolutionsData() {
            try {
                const response = await fetch('/api/reports/meeting-tasks/pending-resolutions');
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                const pendingTab = document.getElementById('tab-pending-resolutions');
                
                if (data.tasks.length === 0) {
                    pendingTab.innerHTML = '<h2>â³ å¾…åŒæ„æ±ºè­°é …ç›®</h2><div class="no-data"><div class="icon">ğŸ‰</div><p>å¤ªæ£’äº†ï¼æ²’æœ‰å¾…åŒæ„çš„æ±ºè­°é …ç›®</p></div>';
                    return;
                }
                
                let html = '<h2>â³ å¾…åŒæ„æ±ºè­°é …ç›®</h2>';
                html += `<p style="color: var(--color-warning); margin-bottom: 20px;">ğŸ“ å…±æœ‰ ${data.total} å€‹æ±ºè­°é …ç›®å¾…æ‚¨åŒæ„</p>`;
                html += '<table class="data-table">';
                html += '<thead><tr>';
                html += '<th>ç·¨è™Ÿ</th>';
                html += '<th>æœƒè­°ä¸»é¡Œ</th>';
                html += '<th>æœƒè­°æ—¥æœŸ</th>';
                html += '<th>æ±ºè­°å…§å®¹</th>';
                html += '<th>è² è²¬äºº</th>';
                html += '<th>ç®¡åˆ¶è€…</th>';
                html += '<th>å»ºç«‹æ™‚é–“</th>';
                html += '<th>ç‹€æ…‹</th>';
                html += '</tr></thead>';
                html += '<tbody>';
                
                data.tasks.forEach((task, index) => {
                    html += '<tr style="background: #fffbeb;">';  // æ·ºé»ƒè‰²èƒŒæ™¯
                    html += `<td>${index + 1}</td>`;
                    html += `<td>${escapeHtml(task.meeting_subject || '-')}</td>`;
                    html += `<td>${task.meeting_date || '-'}</td>`;
                    html += `<td>${escapeHtml(task.task_description)}</td>`;
                    html += `<td>${escapeHtml(task.assigned_to_name || '-')}</td>`;
                    html += `<td>${escapeHtml(task.controller_name || '-')}</td>`;
                    html += `<td>${task.created_at || '-'}</td>`;
                    html += `<td><span class="status-badge status-in-progress">â³ å¾…åŒæ„</span></td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                pendingTab.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading pending resolutions:', error);
                showError('è¼‰å…¥å¾…åŒæ„æ±ºè­°å¤±æ•—');
            }
        }

        // è¼‰å…¥å¾…æŒ‡æ´¾è¿½è¹¤é …ç›®
        async function loadUnassignedTrackingData() {
            try {
                const response = await fetch('/api/reports/meeting-tasks/unassigned-tracking');
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                const unassignedTab = document.getElementById('tab-unassigned-tracking');
                
                if (data.tasks.length === 0) {
                    unassignedTab.innerHTML = '<h2>â¸ï¸ å¾…æŒ‡æ´¾è¿½è¹¤é …ç›®</h2><div class="no-data"><div class="icon">ğŸ‰</div><p>å¤ªæ£’äº†ï¼æ²’æœ‰å¾…æŒ‡æ´¾çš„è¿½è¹¤é …ç›®</p></div>';
                    return;
                }
                
                let html = '<h2>â¸ï¸ å¾…æŒ‡æ´¾è¿½è¹¤é …ç›®</h2>';
                html += `<p style="color: var(--color-info); margin-bottom: 20px;">â¸ï¸ å…±æœ‰ ${data.total} å€‹è¿½è¹¤é …ç›®å¾…æŒ‡æ´¾</p>`;
                html += '<table class="data-table">';
                html += '<thead><tr>';
                html += '<th>ç·¨è™Ÿ</th>';
                html += '<th>æœƒè­°ä¸»é¡Œ</th>';
                html += '<th>æœƒè­°æ—¥æœŸ</th>';
                html += '<th>è¿½è¹¤å…§å®¹</th>';
                html += '<th>è² è²¬äºº</th>';
                html += '<th>ç®¡åˆ¶è€…</th>';
                html += '<th>é è¨ˆå®Œæˆ</th>';
                html += '<th>å»ºç«‹æ™‚é–“</th>';
                html += '<th>ç‹€æ…‹</th>';
                html += '</tr></thead>';
                html += '<tbody>';
                
                data.tasks.forEach((task, index) => {
                    html += '<tr style="background: #f0f9ff;">';  // æ·ºè—è‰²èƒŒæ™¯
                    html += `<td>${index + 1}</td>`;
                    html += `<td>${escapeHtml(task.meeting_subject || '-')}</td>`;
                    html += `<td>${task.meeting_date || '-'}</td>`;
                    html += `<td>${escapeHtml(task.task_description)}</td>`;
                    html += `<td>${escapeHtml(task.assigned_to_name || '-')}</td>`;
                    html += `<td>${escapeHtml(task.controller_name || '-')}</td>`;
                    html += `<td>${task.expected_completion_date || '-'}</td>`;
                    html += `<td>${task.created_at || '-'}</td>`;
                    html += `<td><span class="status-badge status-unassigned">â¸ï¸ å¾…æŒ‡æ´¾</span></td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                unassignedTab.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading unassigned tracking:', error);
                showError('è¼‰å…¥å¾…æŒ‡æ´¾è¿½è¹¤å¤±æ•—');
            }
        }

        // å·¥å…·å‡½æ•¸
        function showError(message) {
            alert(message);
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
