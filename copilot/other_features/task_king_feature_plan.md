
10/2 
協理建議
專案指派可以跨會議日期與時間匯出所有任務事項?
會出任務事項包含已完成即完成項目?

任務事項欄位增加執行成果欄位,當時既完成日期後,
應填上執行的成果,
以檢視是否符合任務事項的要求.

三廠廠長建議

廠長早

建議方案一. 結合戰情系統增設任務視窗,於承辦每日開啟時直接顯示未指派/未完成項目。
                      說明: 因至今仍有多數承辦未習慣每日開啟"每週待辦事項管理系統"。 
                               目前新版瀏覽器對於崁入式網頁安全要求嚴格，之前測試可以崁入但是無法登入，就算崁入他們還是要到系統維護，目前只能用mail通知 。

建議方案二. 每週待辦事項管理系統增設"任務未完工"總表,以利於上階管理者用總表跟催管制。
                           目前在首頁主管登能很清楚看到 每個人未完成任務，建議 檢討 個人任務約定時間的精準度，又或者被指派任務人員臨時追加任務過多造成，後續針對未完成項目來增加新功能可以請使用者填寫未完成原因 加上調整新的預計完成時間。

# 「任務王」功能開發計畫

## 1. 功能目標
為了提升系統的趣味性和使用者參與度，引入遊戲化機制。透過每月評選出完成最多任務的「任務王」，給予榮譽和及時的視覺反饋，以激勵所有成員。

## 2. 核心規則
- **評選對象**: 上個月內完成最多任務的使用者。
- **任務範圍**: 計算範圍包含「一般任務(Todo)」和「會議任務(MeetingTask)」。
- **平手規則**: 若有多人完成數量相同，則**並列為冠軍**，所有同分最高者都會顯示。
- **顯示時機**: 在**每個月的第一個工作日**（週一至週五），所有使用者當日首次登入系統時，會觸發一次全螢幕動畫。

## 3. 使用者體驗與動畫效果
將使用純 HTML 和 CSS 打造一個輕量且具慶祝氛圍的動畫，不影響頁面載入速度。
1.  **聚光燈效果**: 使用者登入後，畫面變暗，一道聚光燈聚焦於螢幕中央。
2.  **資訊框浮現**: 「任務王」的資訊框從聚光燈中浮現。
3.  **加冕與慶祝**: 冠軍姓名上方會出現一個閃爍的金色皇冠圖示，同時伴隨五彩紙屑的動畫效果。
4.  **靜態展示**: 動畫結束後，畫面會停留在顯示冠軍資訊的彈出視窗，使用者可手動關閉。

## 4. 技術實作方案 (方案A)

### 階段一：後端開發
1.  **資料庫準備**:
    - **新增 `completed_at` 欄位**: 為 `Todo` 和 `ArchivedTodo` 資料表新增 `completed_at` (DATETIME) 欄位，用於準確記錄一般任務的完成時間。
    - **新增 `TaskKingLog` 資料表**: 建立一個新資料表，用於儲存每個月的任務王計算結果。欄位包含 `year`, `month`, `user_id`, `task_count`。
    - **產生遷移腳本**: 透過 `flask db migrate` 和 `flask db upgrade` 套用上述變更。

2.  **核心邏輯實作**:
    - **更新 `update_todo_status`**: 修改此函式，當一般任務的狀態被設為 `COMPLETED` 時，自動將當前時間填入 `completed_at` 欄位。
    - **建立排程任務 `calculate_task_king`**:
        - 在 `scheduler.py` 中新增此函式，設定於每月 1 號凌晨執行。
        - **分開計算**:
            - 從 `ArchivedTodo` 查詢上個月完成的「一般任務」數量。
            - 從 `MeetingTask` 查詢上個月完成的「會議任務」數量 (使用 `actual_completion_date` 欄位)。
        - **加總與排序**: 將兩邊的數據依使用者 ID 加總，找出冠軍。
        - **儲存結果**: 將冠軍(們)的資訊寫入 `TaskKingLog` 資料表。
    - **建立 API 端點 `/api/task_king_announcement`**:
        - 供前端呼叫，用來判斷今天是否為顯示日。
        - 如果是，則從 `TaskKingLog` 提取上個月的冠軍資訊並回傳。

### 階段二：前端開發
1.  **UI 與動畫**:
    - 在 `index.html` 中新增彈出視窗的 HTML 結構。
    - 在 CSS 檔案中撰寫聚光燈、皇冠、彩帶等動畫效果的樣式。
2.  **顯示邏輯**:
    - 在主要 JavaScript 檔案中新增邏輯。
    - 頁面載入後呼叫 API，若 API 回傳需要顯示，則觸發動畫並填入冠軍資料。
    - 使用 `sessionStorage` 確保動畫在同一個瀏覽器工作階段中只顯示一次。

## 5. 重要備註
> **備註：** 施作前請建立腳本查看資料表結構，後詳細確認一下計畫內容。
