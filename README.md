# 每週待辦事項管理系統

## 專案描述

這是一個基於 Flask 開發的輕量級每週待辦事項管理系統，旨在幫助團隊或個人有效地追蹤和管理任務。系統支援組織架構展示、使用者認證、角色權限控制、任務指派、狀態更新以及自動化的任務歸檔和報告生成功能。

## 主要功能

*   **使用者認證與授權**：
    *   安全的使用者登入、登出。
    *   密碼雜湊儲存，支援帳戶鎖定機制。
    *   首次登入強制修改密碼。
    *   基於角色的存取控制 (RBAC)，區分管理員、協理、廠長、經理、課長、組長、作業員等不同層級。

*   **組織架構展示**：
    *   動態生成並展示公司組織架構圖，包含各部門、單位及人員。
    *   顯示每位使用者的任務總數和已完成任務數。

*   **任務管理**：
    *   新增、查看、更新「本週進度」和「下週計畫」任務。
    *   任務狀態（待開始、進行中、已完成、未完成）管理。
    *   任務歷史記錄追蹤。

*   **任務指派**：
    *   上級主管可指派任務給下屬。
    *   指派權限根據組織層級和部門/單位進行精細控制。

*   **報告中心**：
    *   提供部門層級的任務完成率統計。
    *   生成每週和每月任務報告，詳細列出已歸檔任務的完成情況。

*   **自動化任務處理**：
    *   每週自動將「下週計畫」任務轉移為「本週進度」。
    *   每週自動歸檔已完成的「本週進度」任務。

*   **使用者管理 (管理員專用)**：
    *   新增、編輯、刪除使用者帳號。
    *   啟用/停用使用者帳號。
    *   重置使用者密碼為預設值，並強制首次登入修改。

*   **資料匯出/匯入**：
    *   提供腳本將使用者資料匯出為 XLSX 檔案。
    *   提供腳本從 XLSX 檔案批量匯入使用者資料。

## 使用的技術

*   **後端框架**：Flask
*   **資料庫**：SQLite (開發環境，可擴展至 PostgreSQL/MySQL)
*   **ORM**：Flask-SQLAlchemy
*   **密碼雜湊**：Werkzeug Security
*   **排程任務**：APScheduler
*   **環境變數管理**：python-dotenv
*   **Excel 處理**：OpenPyxl (用於匯出/匯入腳本)
*   **前端**：HTML, CSS, JavaScript (原生)

## 安裝與設定

### 1. 克隆儲存庫

```bash
git clone https://github.com/jasonkiller200/Todothis.git
cd Todothis
```

### 2. 建立並啟用虛擬環境

建議使用虛擬環境來管理專案依賴。

```bash
python -m venv .venv
# Windows
.venv\Scripts\activate
# macOS/Linux
source .venv/bin/activate
```

### 3. 安裝依賴

```bash
pip install -r requirements.txt
```

### 4. 設定環境變數

在專案根目錄下建立一個 `.env` 檔案，並設定 `SECRET_KEY`。這是一個用於 Flask Session 安全的隨機字串。

```
SECRET_KEY='your_super_secret_key_here'
```

### 5. 資料庫初始化

首次運行應用程式時，資料庫會自動建立並初始化範例資料（如果資料庫為空）。

## 如何運行

在啟用虛擬環境後，運行 Flask 應用程式：

```bash
python app.py
```

應用程式將在 `http://127.0.0.1:5000/` (或您本機的 IP 地址，如果配置為區域網路測試) 上運行。

### 區域網路 (LAN) 測試

如果您想在區域網路內測試，應用程式已配置為監聽所有網路介面。您可以使用您電腦的 IP 地址 (例如 `http://192.168.1.100:5000/`) 從其他設備訪問。

## 預設管理員帳號

首次運行應用程式並初始化範例資料後，您可以使用以下憑證登入管理員帳號：

*   **電子郵件**：`admin@admin.com`
*   **密碼**：`admin`

其他範例使用者（如 `exec.manager@hartford.com.tw` 等）的預設密碼為 `password123`，首次登入後會強制要求修改。

## 資料匯出/匯入腳本

專案提供了兩個獨立的 Python 腳本，用於使用者資料的批量處理：

*   `export_users.py`：將資料庫中的所有使用者資料匯出到 `users_export.xlsx` 檔案。
*   `import_users.py`：從 `users_export.xlsx` 檔案中讀取資料並批量匯入到資料庫。

**使用方法**：

```bash
# 匯出使用者資料
python export_users.py

# 匯入使用者資料 (請務必備份資料庫！)
python import_users.py
```

**重要提示**：匯入腳本會檢查 `user_key` 和 `email` 是否已存在，如果存在則跳過。匯入時 `password_hash` 欄位會直接使用 XLSX 檔案中的值，請確保其為已雜湊的密碼。

## 近期優化與改進

*   **統一 Enum 使用**：將程式碼中硬編碼的字串替換為 `config.py` 中定義的 Enum 成員，提高可維護性。
*   **組織結構深複製**：解決了組織圖中人員重複顯示的問題，確保每次建構組織結構時都是從獨立的副本開始。
*   **統一權限階層定義**：將 `level_hierarchy` 的定義集中到 `config.py` 中的 `LEVEL_ORDER`，避免重複。
*   **重構報告生成邏輯**：將 `get_weekly_report` 和 `get_monthly_report` 中的重複程式碼提取為通用輔助函式，提高程式碼重用性。
*   **引入標準日誌記錄**：將 `print()` 語句替換為 Python 的 `logging` 模組，便於日誌管理和調試。
*   **集中管理「魔術數字」**：將登入失敗次數限制、帳戶鎖定時間等配置移至 `config.py`。
*   **優化使用者權限**：精細化廠長/經理和課長/副課長查看個人工作詳情的權限，使其只能查看自己單位或下屬單位的人員。
*   **重置密碼功能增強**：重置密碼時統一設定為預設密碼 `password123`，並強制使用者在下次登入時修改密碼。
*   **區域網路測試配置**：修改 Flask 應用程式監聽所有網路介面，方便在區域網路內進行測試。

## 貢獻

歡迎任何形式的貢獻！如果您有任何建議或發現 Bug，請隨時提交 Issue 或 Pull Request。

## 授權

[請在此處填寫您的專案授權資訊，例如 MIT License 或其他開源授權。]
